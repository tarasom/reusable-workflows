name: Scale Infrastructure


on:
  workflow_dispatch:
    environment: production

jobs:
  resize-usual-workload:
    name: Resize Usual Workload Node Pool
    uses: tarasom/reusable-workflows/.github/workflows/node-pool-scaling.yml@main
    secrets:
      service_account_key: ${{ vars.CLUSTER_NAME }}
    with:
      project_id: vimeo-venues-dev
      region: us-east1
      cluster_name: venues-dev
      node_pool: np-dev-main
      num_nodes: 1

  resize-heavy-workload:
    name: Resize Heavy Workload Node Pool
    uses: tarasom/reusable-workflows/.github/workflows/node-pool-scaling.yml@main
    needs: resize-usual-workload
    secrets:
      service_account_key: ${{ secrets.CLUSTER_NAME }}
    with:
      project_id: vimeo-venues-dev
      region: us-east1
      cluster_name: venues-dev
      node_pool: np-dev-spot
      num_nodes: 0
